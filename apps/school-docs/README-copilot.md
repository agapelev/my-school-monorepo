## Astro + компоненты в Markdown — краткая инструкция (для коллег)

Этот файл объясняет, как Astro обрабатывает компоненты в Markdown-файлах, какие предупреждения генерирует markdownlint, почему они появляются и какие есть варианты решения.

### Как Astro обрабатывает компоненты в `.md` и `.mdx`

- `.mdx`: нативная поддержка компонентов (JSX/TSX) — вы можете напрямую вставлять React/Vue/Svelte/астро-компоненты и выражения. Astro использует MDX при обработке `.mdx` и компоненты монтируются корректно.
- `.md` (обычный Markdown): Astro также умеет рендерить компоненты внутри Markdown при использовании его интеграции (зависит от настроек Markdown renderer). Тем не менее многие линтеры и инструменты ожидают «чистый» Markdown и считают любые теги вида `<Component />` за inline HTML — это вызывает предупреждение MD033 и похожие.

Резюме: для «правильной» работы с компонентами в контенте предпочитают `.mdx`, но можно оставить `.md` и настроить линтер/сборку.

---

## Часто встречающиеся markdownlint предупреждения (MDxxx) — что означают и как исправить

Ниже — список предупреждений, которые встречались в разделе `01_conflict`, с объяснением, причинами и рекомендованными правками.

- MD033 — inline HTML

  - Что: Вставка HTML-тегов (или тегов компонентов как `<AudioPlayer />`) внутри Markdown.
  - Почему возникает: markdownlint считает это raw HTML — в обычном Markdown это допустимо, но правило сигнализирует о встраиваемом HTML.
  - Влияние: если вы хотите хранить компоненты в Markdown, это предупреждение будет постоянно. Оно не ломает сайт, но засоряет CI/PR и мешает линтингу.
  - Fixes:
    1. Лучший — переименовать файл в `.mdx` (см. ниже) и использовать компоненты нативно.
    2. Если не хотите .mdx — отключить правило для файла / для проекта: в файле вставить `<!-- markdownlint-disable MD033 -->` (вверху) или в конфиге `.markdownlint.json` указать исключение.
    3. Альтернатива — вынести медиа в shortcodes/эпизоды, вставлять через ссылку и рендерить компонент на стороне шаблона.

- MD024 — duplicate heading

  - Что: В файле обнаружены одинаковые заголовки (одинаковое содержимое нескольких H2/H3 и т.п.).
  - Почему: при слиянии/реставрации текста могли появиться дубли.
  - Влияние: мешает удобочитаемости и может ломать оглавления/индексацию.
  - Fix: удалить дублирующие заголовки или сделать их уникальными (например, добавить уточнение или объединить секции).

- MD001 / MD003 / MD018 / MD022 — проблемы со стилем заголовков и пустыми строками

  - MD001 (heading-increment): заголовки должны инкрементироваться по одному уровню за раз (например, нельзя прыгать с `###` сразу на `#####`).
  - MD003 (heading-style): ожидается определённый стиль (обычно ATX: `# Heading`) — иногда парсер встречает setext-style (`Heading\n======`).
  - MD018: нужен пробел после символов `#` (например `# Заголовок`, не `#Заголовок`).
  - MD022: вокруг заголовков должны быть пустые строки.
  - Fix:
    - Нормализовать уровни заголовков; не делать резких прыжков уровней.
    - Убедиться, что перед и после заголовка есть пустая строка.
    - Добавить пробел после `#`.

- MD026 — trailing punctuation in heading

  - Что: заголовок заканчивается на знаки препинания (например, `:` или `?`).
  - Почему: некоторые заголовки (напр., метки стихов «Откровение 3:1:») имеют символы в конце — линтер трактует это как потенциальную ошибку.
  - Fix: удалить завершающую пунктуацию в заголовке (или уменьшить уровень/перенести знак в тело текста). Если это важно для смысла, можно выключить правило для конкретных заголовков.

- MD009 — trailing spaces

  - Что: в строках есть trailing spaces (концевые пробелы).
  - Fix: удалить завершающие пробелы (обычно безопасно, автоматические инструменты справляются).

- MD041 — first-line-heading

  - Что: первый немаркировочный (не-frontmatter) контент в файле не является H1-заголовком.
  - Почему: если вы используете frontmatter (YAML/JS) и не ставите явный `# Title`, линтер может требовать H1.
  - Fix: добавить `# <title>` в начало документа (после frontmatter) или отключить правило для файлов, где title вынесен в frontmatter.

- MD032 — blank lines around lists (и похожие)
  - Fix: убедитесь в пустой строке перед списками/блоком цитаты и после них.

---

## Какие варианты действий у нас есть (рекомендации)

1. Быстрый и минимальный — добавить локальные подавления правил в проблемных файлах

   - В начале `01_conflict.md` добавить строку: `<!-- markdownlint-disable MD033 MD024 MD026 -->`.
   - Плюс: минимум изменений в тексте, быстро проходит CI.
   - Минус: правила остаются отключёнными (могут скрыть реальные проблемы).

2. Нормализовать Markdown (lint-fix)

   - Исправить заголовки (убрать дубликаты, снизить уровень `#####` → `####`, убрать trailing `:` в заголовках), убрать trailing spaces и лишние отступы/код-блоки, удалить дубликаты параграфов.
   - Плюс: чистый контент, линтер будет «зелёным».
   - Минус: потребуется ручная проверка, чтобы не изменить смысл (особенно в религиозных/цитатных местах).

3. Конвертация `.md` → `.mdx` (рекомендую для контента, где много компонентов)

   - Преимущества:
     - MDX официально поддерживает компоненты — MD033 перестаёт быть «проблемой» логически (но линтер всё равно может ругаться, если не настроен для MDX).
     - Более гибкие возможности: импорт/экспорт, inline-выражения, компоненты, контекст.
   - Что нужно сделать:
     - Переименовать файл `01_conflict.md` → `01_conflict.mdx` (и аналогично в других файлах, где хотите компоненты).
     - Проверить frontmatter: Astro поддерживает JS/YAML frontmatter в MDX; убедиться что импорты/exports корректны.
     - Обновить CI/linters: настроить markdownlint (или ESLint/remark) так, чтобы он корректно обрабатывал MDX (есть плагины `markdownlint-cli` + `remark` + `remark-mdx` и т.д.).
   - Минусы:
     - Понадобится прогнать маленькие адаптации в сборке/инструментах и в линтере.
     - Миграция большого корпуса `.md` → `.mdx` требует времени и ревью.

4. Настроить проектный линтер
   - В корне добавить/обновить `.markdownlint.json` и перечислить правила, которые хотите отключить глобально для контентной директории.
   - Пример: отключить MD033 для `src/content/**`.

---

## Примеры конфигураций

- Отключить MD033 в конкретном файле (вставить в начало файла):

  <!-- markdownlint-disable MD033 -->

- Пример `.markdownlint.json` для отключения MD033 в контентной папке:

```
{
  "default": true,
  "MD033": false
}
```

(Если вы хотите более тонкую фильтрацию — используйте отдельные конфиги в подпапках или добавьте исключения в CI.)

---

## Итого / рекомендации для вас сейчас

- Если цель — быстро избавиться от предупреждений и оставить `.md` файлов без многомесячной миграции — я могу сделать targeted lint-fix для `01_conflict.md` (правки заголовков, удалить явные дубли, убрать trailing spaces) и оставить `<!-- markdownlint-disable MD033 -->` сверху, чтобы компоненты не трогали линтер.
- Если вы планируете активно использовать компоненты внутри контента — рекомендую перейти на `.mdx` для таких страниц и настроить линтер для MDX; это будет более чистым решением на долгую.

---

Если хотите, я сейчас выполню один из вариантов:

- A) Прямой lint-fix `01_conflict.md` (правлю заголовки/дубли/пробелы) — потребует ваше подтверждение на минимальные правки заголовков (убрать завершающие «:», согласовать уровни).
- B) Оставить `01_conflict.md` как есть и только добавить подавления правил (вставить `<!-- markdownlint-disable ... -->`).
- C) Помочь переименовать `*.md`→`*.mdx` (я могу выполнить для одного файла и показать результат).

Скажите, какой вариант предпочитаете — и я выполню правки.
